# ESP32智能控制系统 - 微信小程序

## 📱 项目简介

这是一个专为ESP32智能控制系统设计的微信小程序，提供以下核心功能：

- **实时监控**: 显示AD1通道的实时数据
- **远程控制**: 通过手机控制IO1开关状态
- **状态同步**: 实时同步设备状态和控制状态
- **历史记录**: 查看数据采集和控制历史
- **用户管理**: 集成微信用户授权登录

## 🏗️ 技术架构

### 前端技术
- **框架**: 微信小程序原生框架
- **语言**: WXML + WXSS + JavaScript (ES6+)
- **样式**: 响应式设计，支持不同屏幕尺寸

### 后端接口
- **协议**: HTTP RESTful API
- **数据格式**: JSON
- **服务器**: Python Flask (你现有的后端系统)

### 网络配置
- **连接方式**: 同一WiFi网络下的IP访问
- **端口**: 5000 (默认)
- **协议**: HTTP

## 🚀 快速开始

### 1. 环境准备

#### 微信开发者工具
1. 下载并安装 [微信开发者工具](https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html)
2. 注册微信小程序账号，获取AppID

#### 后端服务
确保你的ESP32后端系统正在运行：
```bash
python main.py
```

### 2. 网络配置

#### 获取服务器IP地址
在运行后端服务的电脑上执行：
```bash
ipconfig  # Windows
# 或
ifconfig  # macOS/Linux
```

#### 修改小程序配置
编辑 `app.js` 文件，修改服务器IP地址：
```javascript
serverConfig: {
  baseUrl: 'http://YOUR_SERVER_IP:5000/api', // 替换为你的实际IP
  timeout: 10000
}
```

### 3. 导入项目

1. 打开微信开发者工具
2. 选择"导入项目"
3. 选择项目目录：`miniprogram/`
4. 输入你的AppID
5. 点击"导入"

### 4. 配置项目

#### 修改AppID
编辑 `project.config.json`：
```json
{
  "appid": "your_actual_app_id_here"
}
```

#### 配置服务器地址
确保 `app.js` 中的服务器IP地址正确。

### 5. 测试运行

1. 在微信开发者工具中点击"编译"
2. 使用模拟器预览功能
3. 点击"预览"生成二维码，用微信扫码测试

## 📋 功能说明

### 首页 (Dashboard)
- **系统状态**: 显示MQTT连接和设备状态
- **AD1数据**: 实时显示模拟数据值
- **IO1控制**: 快速开关控制
- **快速导航**: 跳转到其他功能页面

### 控制页面
- **连接状态**: 实时监控MQTT和设备连接
- **IO1控制**: 专业的开关控制界面
- **控制历史**: 查看所有控制操作记录
- **批量控制**: 支持控制序列设置
- **控制设置**: 个性化控制参数配置

### 数据页面
- **实时数据**: 显示AD1通道的实时数值
- **历史数据**: 查看数据采集历史记录
- **数据图表**: 数据趋势可视化
- **数据导出**: 支持数据导出功能

### 个人中心
- **用户信息**: 显示微信用户基本信息
- **使用统计**: 显示使用频率和操作统计
- **设置选项**: 个性化设置和偏好配置
- **关于信息**: 应用版本和帮助信息

## 🔧 配置说明

### 网络配置
```javascript
// app.js
serverConfig: {
  baseUrl: 'http://192.168.1.100:5000/api', // 修改为你的服务器IP
  timeout: 10000  // 请求超时时间(毫秒)
}
```

### 自动刷新配置
```javascript
// 首页自动刷新间隔(毫秒)
startAutoRefresh() {
  this.data.refreshTimer = setInterval(() => {
    this.refreshAllData();
  }, 30000); // 30秒
}
```

### 控制确认配置
```javascript
// 控制页面设置
confirmDialog: true,    // 是否显示确认对话框
soundAlert: true,       // 是否启用声音提示
```

## 📱 使用说明

### 基本操作流程

1. **启动小程序**
   - 在微信中搜索你的小程序
   - 或扫描开发者工具生成的预览二维码

2. **授权登录**
   - 首次使用需要授权获取用户信息
   - 点击"获取用户信息"按钮

3. **查看状态**
   - 首页自动显示系统状态和实时数据
   - 点击"刷新状态"手动更新

4. **控制设备**
   - 在首页或控制页面点击开关按钮
   - 确认操作后执行控制命令

5. **查看历史**
   - 在相应页面点击"查看历史"按钮
   - 选择显示条数后加载数据

### 注意事项

- **网络要求**: 手机和服务器必须在同一WiFi网络
- **权限要求**: 需要微信用户授权获取基本信息
- **实时性**: 数据每30秒自动刷新，也可手动刷新
- **错误处理**: 网络异常时会显示错误提示和重试按钮

## 🐛 常见问题

### Q: 小程序无法连接到服务器
**A**: 检查以下配置：
1. 服务器IP地址是否正确
2. 手机和服务器是否在同一网络
3. 防火墙是否阻止了5000端口
4. 后端服务是否正在运行

### Q: 控制命令执行失败
**A**: 可能的原因：
1. MQTT连接断开
2. ESP32设备离线
3. 网络延迟过高
4. 后端服务异常

### Q: 数据不更新
**A**: 解决方案：
1. 检查自动刷新是否开启
2. 手动点击刷新按钮
3. 检查网络连接状态
4. 重启小程序

### Q: 微信授权失败
**A**: 处理方法：
1. 检查微信版本是否支持
2. 重新授权用户信息
3. 清除小程序缓存后重试

## 🔄 更新维护

### 版本更新
1. 修改代码后重新编译
2. 测试功能正常后上传代码
3. 提交审核并发布新版本

### 功能扩展
- 支持更多传感器数据
- 添加设备管理功能
- 实现用户权限控制
- 增加数据分析和报警功能

## 📞 技术支持

如有问题或建议，请联系开发团队或查看项目文档。

---

**版本**: 1.0.0  
**更新时间**: 2024年1月  
**兼容性**: 微信 7.0.0+

**说明**: 微信小程序暂时未测试
