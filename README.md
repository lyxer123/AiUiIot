# ESP32æ•°æ®é‡‡é›†å’Œæ§åˆ¶ç³»ç»Ÿ

## é¡¹ç›®ç®€ä»‹

è¿™æ˜¯ä¸€ä¸ªåŸºäºPythonçš„ESP32æ•°æ®é‡‡é›†å’Œæ§åˆ¶ç³»ç»Ÿï¼Œæ”¯æŒåŒ—å‘é‡‡é›†AD1é€šé“æ•°æ®ï¼Œå—å‘æ§åˆ¶IO1å¼€å…³ã€‚ç³»ç»Ÿé‡‡ç”¨MQTTé€šä¿¡åè®®ï¼ŒJSONæ•°æ®æ ¼å¼ï¼Œæä¾›å®Œæ•´çš„åå°ç®¡ç†å’ŒWeb APIæ¥å£ã€‚

## ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    MQTT    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTP    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ESP32     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   åå°ç³»ç»Ÿ   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Android   â”‚
â”‚  è®¾å¤‡/æ¨¡æ‹Ÿå™¨ â”‚            â”‚             â”‚            â”‚     APP     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   SQLite    â”‚
                        â”‚   æ•°æ®åº“    â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## åŠŸèƒ½ç‰¹æ€§

### åŒ—å‘æ•°æ®é‡‡é›†
- **AD1é€šé“æ•°æ®é‡‡é›†**: å®æ—¶é‡‡é›†æ¨¡æ‹Ÿé‡æ•°æ®
- **æ•°æ®å­˜å‚¨**: è‡ªåŠ¨ä¿å­˜åˆ°SQLiteæ•°æ®åº“
- **å†å²æŸ¥è¯¢**: æ”¯æŒæŒ‰æ—¶é—´èŒƒå›´æŸ¥è¯¢å†å²æ•°æ®

### å—å‘è®¾å¤‡æ§åˆ¶
- **IO1å¼€å…³æ§åˆ¶**: è¿œç¨‹æ§åˆ¶æ•°å­—è¾“å‡º
- **çŠ¶æ€åé¦ˆ**: å®æ—¶è·å–è®¾å¤‡æ§åˆ¶çŠ¶æ€
- **æ§åˆ¶å†å²**: è®°å½•æ‰€æœ‰æ§åˆ¶æ“ä½œ

### é€šä¿¡åè®®
- **MQTTåè®®**: è½»é‡çº§æ¶ˆæ¯ä¼ è¾“
- **JSONæ ¼å¼**: æ ‡å‡†æ•°æ®äº¤æ¢æ ¼å¼
- **ä¸»é¢˜è®¢é˜…**: æ”¯æŒå¤šè®¾å¤‡æ¥å…¥

### ç³»ç»Ÿç®¡ç†
- **Web API**: RESTfulæ¥å£ä¾›APPè°ƒç”¨
- **å®æ—¶ç›‘æ§**: ç³»ç»ŸçŠ¶æ€å®æ—¶ç›‘æ§
- **æ—¥å¿—è®°å½•**: å®Œæ•´çš„æ“ä½œæ—¥å¿—

## ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Windows 11/10
- **Pythonç‰ˆæœ¬**: 3.7+
- **MQTTä»£ç†**: Mosquitto
- **å†…å­˜è¦æ±‚**: æœ€å°512MBï¼Œæ¨è1GB+
- **å­˜å‚¨ç©ºé—´**: æœ€å°100MB

## ğŸ“¸ åº”ç”¨ç•Œé¢å±•ç¤º

### 1. webåº”ç”¨ç•Œé¢
![åº”ç”¨å¯åŠ¨ç•Œé¢](pic/1.png)

### 2. åå°æœåŠ¡ç•Œé¢
![ç”¨æˆ·ç™»å½•ç•Œé¢](pic/2.png)

### 3. åå°æœåŠ¡è¿ç»­è¾“å‡ºç•Œé¢
![ä¸»åŠŸèƒ½å¯¼èˆªç•Œé¢](pic/3.png)

### 4. MQTTå®‰è£…ç•Œé¢
![è®¾å¤‡æ§åˆ¶ç•Œé¢](pic/4.png)

### 5. å®‰è£…pythonç›¸å…³ä¾èµ–ç•Œé¢
![æ•°æ®ç›‘æ§ç•Œé¢](pic/5.png)


## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

#### å®‰è£…Python
```bash
# ä¸‹è½½å¹¶å®‰è£…Python 3.7+
# ä¸‹è½½åœ°å€: https://www.python.org/downloads/
```

#### å®‰è£…MQTTä»£ç†
```bash
# è¿è¡Œå®‰è£…è„šæœ¬
install_mqtt.bat

# æˆ–æ‰‹åŠ¨å®‰è£…
# 1. è®¿é—® https://mosquitto.org/download/
# 2. ä¸‹è½½Windowsç‰ˆæœ¬å®‰è£…åŒ…
# 3. å®‰è£…æ—¶é€‰æ‹©"Service"é€‰é¡¹
```

### 2. ä¸€é”®éƒ¨ç½²

#### å®‰è£…ä¾èµ–
```bash
# è¿è¡Œä¾èµ–å®‰è£…è„šæœ¬
install_dependencies.bat
```

#### å¯åŠ¨ç³»ç»Ÿ
```bash
# è¿è¡Œä¸€é”®å¯åŠ¨è„šæœ¬
start_system.bat
```

### 3. éªŒè¯ç³»ç»Ÿ

#### æ£€æŸ¥æœåŠ¡çŠ¶æ€
- MQTTæœåŠ¡: é»˜è®¤ç«¯å£1883
- WebæœåŠ¡: http://localhost:5000
- æ•°æ®åº“: è‡ªåŠ¨åˆ›å»ºSQLiteæ–‡ä»¶

#### æµ‹è¯•åŠŸèƒ½
```bash
# è¿è¡Œç³»ç»Ÿæµ‹è¯•è„šæœ¬
test_system.bat
```

#### Webæµ‹è¯•é¡µé¢
- æ‰“å¼€ `web_test.html` æ–‡ä»¶
- æµ‹è¯•å„é¡¹APIæ¥å£åŠŸèƒ½

## é…ç½®è¯´æ˜

### é…ç½®æ–‡ä»¶ (config.ini)

```ini
[MQTT]
broker = localhost          # MQTTä»£ç†åœ°å€
port = 1883                # MQTTç«¯å£
client_id = esp32_backend  # å®¢æˆ·ç«¯ID
username =                 # ç”¨æˆ·åï¼ˆå¯é€‰ï¼‰
password =                 # å¯†ç ï¼ˆå¯é€‰ï¼‰
keepalive = 60            # ä¿æ´»æ—¶é—´

[TOPICS]
ad1_data = esp32/ad1/data           # AD1æ•°æ®ä¸»é¢˜
io1_control = esp32/io1/control     # IO1æ§åˆ¶ä¸»é¢˜
status = esp32/status               # çŠ¶æ€ä¸»é¢˜

[DATABASE]
db_path = esp32_data.db             # æ•°æ®åº“æ–‡ä»¶è·¯å¾„

[WEB_SERVER]
host = 0.0.0.0                      # WebæœåŠ¡å™¨åœ°å€
port = 5000                         # WebæœåŠ¡å™¨ç«¯å£
debug = True                        # è°ƒè¯•æ¨¡å¼

[ESP32_SIMULATOR]
enabled = True                      # å¯ç”¨æ¨¡æ‹Ÿå™¨
simulation_interval = 5             # æ¨¡æ‹Ÿé—´éš”ï¼ˆç§’ï¼‰
ad1_min = 0                        # AD1æœ€å°å€¼
ad1_max = 4095                     # AD1æœ€å¤§å€¼
io1_default = False                # IO1é»˜è®¤çŠ¶æ€
```

## APIæ¥å£æ–‡æ¡£

### åŸºç¡€ä¿¡æ¯
- **åŸºç¡€URL**: `http://localhost:5000/api`
- **æ•°æ®æ ¼å¼**: JSON
- **ç¼–ç æ–¹å¼**: UTF-8

### æ¥å£åˆ—è¡¨

#### 1. ç³»ç»ŸçŠ¶æ€
```
GET /api/status
å“åº”: {"success": true, "data": {"mqtt_connected": true, "io1_current_state": false, "system_status": "running"}}
```

#### 2. MQTTçŠ¶æ€
```
GET /api/mqtt/status
å“åº”: {"success": true, "data": {"connected": true}}
```

#### 3. AD1æ•°æ®æŸ¥è¯¢
```
GET /api/ad1/data?limit=100
å‚æ•°: limit - è¿”å›æ•°æ®æ¡æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤100ï¼‰
å“åº”: {"success": true, "data": [{"value": 1234, "timestamp": "2024-01-01T00:00:00"}]}
```

#### 4. IO1æ§åˆ¶
```
POST /api/io1/control
è¯·æ±‚ä½“: {"state": true}
å“åº”: {"success": true, "message": "IO1æ§åˆ¶å‘½ä»¤å·²å‘é€: true"}
```

#### 5. IO1çŠ¶æ€æŸ¥è¯¢
```
GET /api/io1/current
å“åº”: {"success": true, "data": {"state": false}}
```

#### 6. IO1æ§åˆ¶å†å²
```
GET /api/io1/control?limit=50
å‚æ•°: limit - è¿”å›æ•°æ®æ¡æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤50ï¼‰
å“åº”: {"success": true, "data": [{"state": true, "timestamp": "2024-01-01T00:00:00"}]}
```

#### 7. è®¾å¤‡çŠ¶æ€å†å²
```
GET /api/device/status?limit=50
å‚æ•°: limit - è¿”å›æ•°æ®æ¡æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤50ï¼‰
å“åº”: {"success": true, "data": [{"status": "online", "timestamp": "2024-01-01T00:00:00"}]}
```

#### 8. APIæµ‹è¯•
```
GET /api/test
å“åº”: {"success": true, "message": "ESP32åå°ç³»ç»ŸAPIè¿è¡Œæ­£å¸¸", "timestamp": "2024-01-01T00:00:00Z"}
```

## MQTTé€šä¿¡åè®®

### ä¸»é¢˜ç»“æ„
- `esp32/ad1/data` - AD1æ•°æ®å‘å¸ƒ
- `esp32/io1/control` - IO1æ§åˆ¶å‘½ä»¤
- `esp32/status` - è®¾å¤‡çŠ¶æ€

### æ¶ˆæ¯æ ¼å¼

#### AD1æ•°æ®
```json
{
    "device_id": "esp32_simulator",
    "channel": "AD1",
    "value": 2048,
    "unit": "ADC",
    "timestamp": "2024-01-01T00:00:00"
}
```

#### IO1æ§åˆ¶
```json
{
    "command": "set_io1",
    "state": true,
    "timestamp": "2024-01-01T00:00:00"
}
```

#### è®¾å¤‡çŠ¶æ€
```json
{
    "device_id": "esp32_simulator",
    "status": "online",
    "io1_state": false,
    "timestamp": "2024-01-01T00:00:00"
}
```

## æ–‡ä»¶ç»“æ„

```
AiUiIot/
â”œâ”€â”€ README.md                 # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ requirements.txt          # Pythonä¾èµ–åŒ…
â”œâ”€â”€ config.ini               # ç³»ç»Ÿé…ç½®æ–‡ä»¶
â”œâ”€â”€ main.py                  # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ database.py              # æ•°æ®åº“ç®¡ç†æ¨¡å—
â”œâ”€â”€ mqtt_client.py           # MQTTå®¢æˆ·ç«¯æ¨¡å—
â”œâ”€â”€ esp32_simulator.py           # ESP32æ¨¡æ‹Ÿå™¨ï¼ˆå·²å¯ç”¨ï¼‰
â”œâ”€â”€ web_server.py            # WebæœåŠ¡å™¨æ¨¡å—
â”œâ”€â”€ web_test.html            # Webæµ‹è¯•é¡µé¢
â”œâ”€â”€ install_mqtt.bat         # MQTTå®‰è£…è„šæœ¬
â”œâ”€â”€ install_dependencies.bat  # ä¾èµ–å®‰è£…è„šæœ¬
â”œâ”€â”€ start_system.bat         # ä¸€é”®å¯åŠ¨è„šæœ¬
â””â”€â”€ test_system.bat          # ç³»ç»Ÿæµ‹è¯•è„šæœ¬
```

## ä½¿ç”¨è¯´æ˜

### å¼€å‘æ¨¡å¼
```bash
# ç›´æ¥è¿è¡ŒPythonç¨‹åº
python main.py
```

### ç”Ÿäº§éƒ¨ç½²
```bash
# ä½¿ç”¨æ‰¹å¤„ç†è„šæœ¬å¯åŠ¨
start_system.bat
```

### åœæ­¢ç³»ç»Ÿ
```bash
# æŒ‰ Ctrl+C åœæ­¢ç¨‹åº
# æˆ–å…³é—­å‘½ä»¤è¡Œçª—å£
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. MQTTè¿æ¥å¤±è´¥
- æ£€æŸ¥MosquittoæœåŠ¡æ˜¯å¦å¯åŠ¨
- ç¡®è®¤ç«¯å£1883æœªè¢«å ç”¨
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

#### 2. Pythonæ¨¡å—å¯¼å…¥é”™è¯¯
- è¿è¡Œ `install_dependencies.bat` å®‰è£…ä¾èµ–
- æ£€æŸ¥Pythonç‰ˆæœ¬æ˜¯å¦ä¸º3.7+

#### 3. æ•°æ®åº“è®¿é—®é”™è¯¯
- æ£€æŸ¥ç¨‹åºè¿è¡Œæƒé™
- ç¡®è®¤ç£ç›˜ç©ºé—´å……è¶³

#### 4. WebæœåŠ¡æ— æ³•è®¿é—®
- æ£€æŸ¥ç«¯å£5000æ˜¯å¦è¢«å ç”¨
- ç¡®è®¤é˜²ç«å¢™å…è®¸è¯¥ç«¯å£

### æ—¥å¿—æŸ¥çœ‹
- æ—¥å¿—æ–‡ä»¶ä½ç½®: `logs/esp32_backend_YYYYMMDD.log`
- å®æ—¶æ—¥å¿—: æ§åˆ¶å°è¾“å‡º

## æ‰©å±•å¼€å‘

### æ·»åŠ æ–°çš„æ•°æ®é€šé“
1. åœ¨ `database.py` ä¸­æ·»åŠ æ–°è¡¨
2. åœ¨ `mqtt_client.py` ä¸­å¤„ç†æ–°ä¸»é¢˜
3. åœ¨ `web_server.py` ä¸­æ·»åŠ APIæ¥å£

### é›†æˆçœŸå®ESP32è®¾å¤‡
1. ä¿®æ”¹ `config.ini` ä¸­çš„MQTTé…ç½®
2. åœ¨ESP32ä¸Šå®ç°å¯¹åº”çš„MQTTå®¢æˆ·ç«¯
3. æŒ‰ç…§åè®®æ ¼å¼å‘é€æ•°æ®

### å¼€å‘Android APP
1. ä½¿ç”¨æä¾›çš„REST APIæ¥å£
2. å®ç°MQTTå®¢æˆ·ç«¯æ¥æ”¶å®æ—¶æ•°æ®
3. è®¾è®¡ç”¨æˆ·å‹å¥½çš„æ§åˆ¶ç•Œé¢

## æŠ€æœ¯æ”¯æŒ

### è”ç³»æ–¹å¼
- é¡¹ç›®åœ°å€: [GitHub Repository]
- é—®é¢˜åé¦ˆ: [Issues]

### æ›´æ–°æ—¥å¿—
- v1.0.0 - åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºç¡€åŠŸèƒ½å®ç°
- æ”¯æŒAD1æ•°æ®é‡‡é›†å’ŒIO1æ§åˆ¶
- é›†æˆESP32æ¨¡æ‹Ÿå™¨ï¼ˆæ™ºèƒ½ADå€¼æ¨¡æ‹Ÿï¼‰
- æä¾›å®Œæ•´çš„Web APIæ¥å£

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ï¼Œè¯¦è§LICENSEæ–‡ä»¶ã€‚

---

**æ³¨æ„**: æœ¬ç³»ç»Ÿä»…ä¾›å­¦ä¹ å’Œæµ‹è¯•ä½¿ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨å‰è¯·è¿›è¡Œå……åˆ†çš„å®‰å…¨è¯„ä¼°å’Œæ€§èƒ½æµ‹è¯•ã€‚
